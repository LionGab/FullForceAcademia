{
  "name": "ğŸ”¥ Academia Full Force - Campanha ReativaÃ§Ã£o MASSIVA",
  "nodes": [
    {
      "parameters": {
        "mode": "webhook",
        "webhookId": "academia-trigger"
      },
      "id": "trigger",
      "name": "ğŸš€ Trigger Campanha",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": "1YviQakfTbBNZWkFOLqxIi5EORfOPmKTJz_qr-inIvo8",
        "sheetName": "Alunos",
        "range": "A:H",
        "options": {
          "headerRow": 1
        }
      },
      "id": "load-members",
      "name": "ğŸ“Š Carregar Base de Alunos",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [460, 300]
    },
    {
      "parameters": {
        "jsCode": "// Segmentar alunos: ATIVOS vs INATIVOS vs PROSPECTS\nconst items = $input.all();\nconst today = new Date();\nconst thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));\nconst sixtyDaysAgo = new Date(today.getTime() - (60 * 24 * 60 * 60 * 1000));\n\nconst segmentedMembers = {\n  inativos_criticos: [],    // +60 dias sem atividade\n  inativos_moderados: [],   // 30-60 dias sem atividade  \n  ativos_baixa_freq: [],    // Ativos mas baixa frequÃªncia\n  prospects: [],            // Nunca foram alunos\n  ativos: []               // FrequÃªncia boa\n};\n\nitems.forEach(item => {\n  const data = item.json;\n  const ultimaAtividade = new Date(data['Ãšltima Atividade'] || data['Data Cadastro']);\n  const status = data.Status?.toLowerCase() || '';\n  const frequencia = parseInt(data['FrequÃªncia Mensal'] || 0);\n  const telefone = data.Telefone?.replace(/\\D/g, '');\n  \n  // Validar telefone\n  if (!telefone || telefone.length < 10) return;\n  \n  const member = {\n    nome: data.Nome,\n    telefone: telefone,\n    email: data.Email,\n    plano: data.Plano,\n    ultimaAtividade: ultimaAtividade.toISOString(),\n    frequencia: frequencia,\n    status: status,\n    valor: data['Valor Plano'] || 0,\n    diasInativo: Math.floor((today - ultimaAtividade) / (1000 * 60 * 60 * 24))\n  };\n  \n  // SEGMENTAÃ‡ÃƒO INTELIGENTE\n  if (ultimaAtividade < sixtyDaysAgo) {\n    segmentedMembers.inativos_criticos.push({\n      ...member,\n      urgencia: 'CRITICA',\n      oferta: 'Volta por R$ 49,90 no primeiro mÃªs',\n      desconto: 70\n    });\n  } else if (ultimaAtividade < thirtyDaysAgo) {\n    segmentedMembers.inativos_moderados.push({\n      ...member,\n      urgencia: 'ALTA',\n      oferta: '50% OFF no prÃ³ximo mÃªs',\n      desconto: 50\n    });\n  } else if (frequencia < 8) {\n    segmentedMembers.ativos_baixa_freq.push({\n      ...member,\n      urgencia: 'MEDIA',\n      oferta: 'Personal grÃ¡tis + AvaliaÃ§Ã£o',\n      desconto: 0\n    });\n  } else if (status.includes('prospect') || status.includes('lead')) {\n    segmentedMembers.prospects.push({\n      ...member,\n      urgencia: 'BAIXA',\n      oferta: '7 dias grÃ¡tis + AvaliaÃ§Ã£o',\n      desconto: 0\n    });\n  } else {\n    segmentedMembers.ativos.push(member);\n  }\n});\n\nreturn [\n  { json: { tipo: 'inativos_criticos', membros: segmentedMembers.inativos_criticos, count: segmentedMembers.inativos_criticos.length } },\n  { json: { tipo: 'inativos_moderados', membros: segmentedMembers.inativos_moderados, count: segmentedMembers.inativos_moderados.length } },\n  { json: { tipo: 'ativos_baixa_freq', membros: segmentedMembers.ativos_baixa_freq, count: segmentedMembers.ativos_baixa_freq.length } },\n  { json: { tipo: 'prospects', membros: segmentedMembers.prospects, count: segmentedMembers.prospects.length } },\n  { json: { tipo: 'resumo', \n    total_inativos: segmentedMembers.inativos_criticos.length + segmentedMembers.inativos_moderados.length,\n    potencial_receita: (segmentedMembers.inativos_criticos.length * 89.90 * 0.3) + (segmentedMembers.inativos_moderados.length * 89.90 * 0.2),\n    meta_conversao: '30% crÃ­ticos + 20% moderados = +' + Math.floor((segmentedMembers.inativos_criticos.length * 0.3) + (segmentedMembers.inativos_moderados.length * 0.2)) + ' alunos'\n  }}\n];"
      },
      "id": "segment-members",
      "name": "ğŸ¯ SegmentaÃ§Ã£o Inteligente",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.tipo }}",
        "rules": {
          "rules": [
            {
              "operation": "equal",
              "value2": "inativos_criticos"
            },
            {
              "operation": "equal",
              "value2": "inativos_moderados"
            },
            {
              "operation": "equal",
              "value2": "ativos_baixa_freq"
            },
            {
              "operation": "equal",
              "value2": "prospects"
            }
          ]
        }
      },
      "id": "route-segments",
      "name": "ğŸ”€ Roteador por UrgÃªncia",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [900, 300]
    },
    {
      "parameters": {
        "jsCode": "// CAMPANHA CRÃTICA - MÃXIMA URGÃŠNCIA\nconst membros = $json.membros;\nconst campanhas = [];\n\nmembros.forEach((membro, index) => {\n  const mensagem = `ğŸš¨ *${membro.nome}*, SENTIMOS SUA FALTA!\\n\\nğŸ’” JÃ¡ sÃ£o ${membro.diasInativo} dias sem vocÃª na academia...\\n\\nğŸ”¥ *OFERTA ESPECIAL SÃ“ HOJE:*\\nğŸ’° ${membro.oferta}\\nâ° *VÃ¡lido atÃ© 23:59h*\\n\\nğŸ’ª Sua saÃºde nÃ£o pode esperar!\\n\\nğŸ“ Responda SIM para garantir`;\n  \n  campanhas.push({\n    json: {\n      telefone: membro.telefone,\n      nome: membro.nome,\n      mensagem: mensagem,\n      urgencia: 'CRITICA',\n      delay: index * 2000, // 2 segundos entre envios\n      followUp1: '6 horas',\n      followUp2: '24 horas',\n      followUp3: '48 horas'\n    }\n  });\n});\n\nreturn campanhas;"
      },
      "id": "campaign-critical",
      "name": "ğŸš¨ CAMPANHA CRÃTICA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 180]
    },
    {
      "parameters": {
        "jsCode": "// CAMPANHA MODERADA - ALTA URGÃŠNCIA\nconst membros = $json.membros;\nconst campanhas = [];\n\nmembros.forEach((membro, index) => {\n  const mensagem = `ğŸ’ª *${membro.nome}*, que saudade!\\n\\nğŸ¯ JÃ¡ sÃ£o ${membro.diasInativo} dias... hora de voltar aos treinos!\\n\\nğŸ”¥ *OFERTA ESPECIAL:*\\nğŸ’° ${membro.oferta}\\nğŸ“… *VÃ¡lido por 48h*\\n\\nâœ¨ Vamos retomar sua evoluÃ§Ã£o?\\n\\nğŸ“ Responda SIM e volte hoje mesmo!`;\n  \n  campanhas.push({\n    json: {\n      telefone: membro.telefone,\n      nome: membro.nome,\n      mensagem: mensagem,\n      urgencia: 'ALTA',\n      delay: index * 3000, // 3 segundos entre envios\n      followUp1: '12 horas',\n      followUp2: '3 dias'\n    }\n  });\n});\n\nreturn campanhas;"
      },
      "id": "campaign-moderate",
      "name": "âš¡ CAMPANHA ALTA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 280]
    },
    {
      "parameters": {
        "jsCode": "// CAMPANHA ENGAJAMENTO - RETENÃ‡ÃƒO\nconst membros = $json.membros;\nconst campanhas = [];\n\nmembros.forEach((membro, index) => {\n  const mensagem = `ğŸ”¥ *${membro.nome}*, vocÃª Ã© TOP!\\n\\nğŸ“Š Notei que sua frequÃªncia pode melhorar...\\n\\nğŸ *PRESENTE ESPECIAL:*\\nğŸ’° ${membro.oferta}\\nğŸ† Vamos turbinar seus resultados?\\n\\nğŸ’ª Que tal um treino hoje?\\n\\nğŸ“ Responda SIM para agendar!`;\n  \n  campanhas.push({\n    json: {\n      telefone: membro.telefone,\n      nome: membro.nome,\n      mensagem: mensagem,\n      urgencia: 'MEDIA',\n      delay: index * 5000, // 5 segundos entre envios\n      followUp1: '1 semana'\n    }\n  });\n});\n\nreturn campanhas;"
      },
      "id": "campaign-engagement",
      "name": "ğŸ¯ CAMPANHA ENGAJAMENTO",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 380]
    },
    {
      "parameters": {
        "jsCode": "// CAMPANHA PROSPECTS - CONVERSÃƒO\nconst membros = $json.membros;\nconst campanhas = [];\n\nmembros.forEach((membro, index) => {\n  const mensagem = `ğŸŒŸ *${membro.nome}*, hora de comeÃ§ar!\\n\\nğŸ’ª Sua transformaÃ§Ã£o te espera na Full Force!\\n\\nğŸ *OFERTA ESPECIAL:*\\nğŸ’° ${membro.oferta}\\nğŸ‹ï¸ Equipamentos de Ãºltima geraÃ§Ã£o\\nğŸ‘¨â€ğŸ« Professores especializados\\n\\nğŸ”¥ Pronto para a mudanÃ§a?\\n\\nğŸ“ Responda SIM e comece hoje!`;\n  \n  campanhas.push({\n    json: {\n      telefone: membro.telefone,\n      nome: membro.nome,\n      mensagem: mensagem,\n      urgencia: 'BAIXA',\n      delay: index * 8000, // 8 segundos entre envios\n      followUp1: '3 dias',\n      followUp2: '1 semana'\n    }\n  });\n});\n\nreturn campanhas;"
      },
      "id": "campaign-prospects",
      "name": "ğŸŒŸ CAMPANHA PROSPECTS",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 480]
    },
    {
      "parameters": {
        "mode": "expression",
        "expression": "={{ $json.delay }}"
      },
      "id": "delay-send",
      "name": "â±ï¸ Delay Inteligente",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:3000/api/sendText",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyContentType": "json",
        "jsonBody": "={\n  \"chatId\": \"{{ $json.telefone }}@c.us\",\n  \"text\": \"{{ $json.mensagem }}\",\n  \"session\": \"default\"\n}",
        "options": {
          "timeout": 10000
        }
      },
      "id": "send-waha",
      "name": "ğŸ“± Enviar via WAHA",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": "1YviQakfTbBNZWkFOLqxIi5EORfOPmKTJz_qr-inIvo8",
        "sheetName": "Campanhas",
        "range": "A:G",
        "options": {
          "headerRow": 1
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Telefone": "={{ $json.telefone }}",
            "Nome": "={{ $json.nome }}",
            "Urgencia": "={{ $json.urgencia }}",
            "Data_Envio": "={{ $now.format('DD/MM/YYYY HH:mm') }}",
            "Status": "Enviado",
            "Tipo_Campanha": "ReativaÃ§Ã£o",
            "Observacoes": "Campanha automÃ¡tica via n8n"
          }
        }
      },
      "id": "log-campaign",
      "name": "ğŸ“Š Log da Campanha",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1780, 300]
    },
    {
      "parameters": {
        "amount": "={{ $json.followUp1 }}",
        "unit": "hours"
      },
      "id": "schedule-followup",
      "name": "ğŸ“… Agendar Follow-up",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [1560, 480]
    },
    {
      "parameters": {
        "jsCode": "// FOLLOW-UP INTELIGENTE\nconst dados = $json;\n\nconst followUpMessages = {\n  CRITICA: `ğŸš¨ *${dados.nome}*, Ãºltima chance!\\n\\nâ° Sua oferta especial expira em 2 horas\\nğŸ’° R$ 49,90 no primeiro mÃªs\\n\\nğŸ’” NÃ£o deixe sua saÃºde para depois!\\n\\nğŸ“ Responda AGORA ou perca esta oportunidade`,\n  \n  ALTA: `âš¡ *${dados.nome}*, ainda dÃ¡ tempo!\\n\\nğŸ¯ Oferta de 50% OFF vÃ¡lida atÃ© amanhÃ£\\nğŸ’ª Seus mÃºsculos sentem sua falta\\n\\nğŸ”¥ Volte hoje e retome sua evoluÃ§Ã£o!\\n\\nğŸ“ Responda SIM para garantir`,\n  \n  MEDIA: `ğŸ’ª *${dados.nome}*, vamos acelerar?\\n\\nğŸ“ˆ Seus resultados podem ser muito melhores\\nğŸ Personal + AvaliaÃ§Ã£o te esperam\\n\\nğŸ† Que tal marcarmos hoje?\\n\\nğŸ“ Responda SIM e vamos nessa!`,\n  \n  BAIXA: `ğŸŒŸ *${dados.nome}*, ainda interessado?\\n\\nâœ¨ 7 dias grÃ¡tis ainda disponÃ­veis\\nğŸ’ª Academia Full Force = Resultados reais\\n\\nğŸ¯ Pronto para comeÃ§ar sua transformaÃ§Ã£o?\\n\\nğŸ“ Responda SIM e comece hoje!`\n};\n\nreturn {\n  json: {\n    telefone: dados.telefone,\n    nome: dados.nome,\n    mensagem: followUpMessages[dados.urgencia],\n    urgencia: dados.urgencia,\n    tipo: 'followup_1'\n  }\n};"
      },
      "id": "followup-message",
      "name": "ğŸ”„ Follow-up Inteligente",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1780, 480]
    }
  ],
  "connections": {
    "ğŸš€ Trigger Campanha": {
      "main": [
        [
          {
            "node": "ğŸ“Š Carregar Base de Alunos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Carregar Base de Alunos": {
      "main": [
        [
          {
            "node": "ğŸ¯ SegmentaÃ§Ã£o Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ SegmentaÃ§Ã£o Inteligente": {
      "main": [
        [
          {
            "node": "ğŸ”€ Roteador por UrgÃªncia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”€ Roteador por UrgÃªncia": {
      "main": [
        [
          {
            "node": "ğŸš¨ CAMPANHA CRÃTICA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âš¡ CAMPANHA ALTA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ¯ CAMPANHA ENGAJAMENTO",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸŒŸ CAMPANHA PROSPECTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸš¨ CAMPANHA CRÃTICA": {
      "main": [
        [
          {
            "node": "â±ï¸ Delay Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš¡ CAMPANHA ALTA": {
      "main": [
        [
          {
            "node": "â±ï¸ Delay Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ CAMPANHA ENGAJAMENTO": {
      "main": [
        [
          {
            "node": "â±ï¸ Delay Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸŒŸ CAMPANHA PROSPECTS": {
      "main": [
        [
          {
            "node": "â±ï¸ Delay Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â±ï¸ Delay Inteligente": {
      "main": [
        [
          {
            "node": "ğŸ“± Enviar via WAHA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Enviar via WAHA": {
      "main": [
        [
          {
            "node": "ğŸ“Š Log da Campanha",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ“… Agendar Follow-up",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“… Agendar Follow-up": {
      "main": [
        [
          {
            "node": "ğŸ”„ Follow-up Inteligente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”„ Follow-up Inteligente": {
      "main": [
        [
          {
            "node": "ğŸ“± Enviar via WAHA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "tags": [
    {
      "name": "Academia"
    },
    {
      "name": "ReativaÃ§Ã£o"
    },
    {
      "name": "WhatsApp"
    },
    {
      "name": "ConversÃ£o"
    }
  ]
}